<link href='css/cutscene.css' rel='stylesheet' type='text/css'>

<div id="header">
	<div id="header_content"></div>
</div>

<div id="timeline"></div>

<div id="footer">
	<div id="footer_icon"></div>
	<div id="footer_copy">Copyright &copy; 2020 PanoptiCorp.</div>
</div>

<script>

///////
var alreadyExited = false;
window.gotoGame = function(){
	if(alreadyExited) return;
	alreadyExited = true;
	window.top.gotoGame();
}

window.onload = function(){

	function generatePost(img){
		return {

			type: "parallax_post",

			user: "Poppy Gardner",
			icon: "icons/poppy.png",
			date: "4 years ago",

			data: {
				height: 400,
				layers:[
					{img:"pics/"+img+".png", depth:0.2, offset:0}
				]
			}

		};
	}

	var posts = [
		generatePost("hugtom0001"),
		generatePost("hugtom0002"),
		generatePost("hugtom0003"),
		generatePost("hugtom0004"),
		generatePost("hugtom0005"),
		generatePost("hugtom0006"),
		generatePost("hugtom0007"),
		generatePost("hugtom0008"),
		generatePost("hugtom0009")
	];

	///////////

	var timeline = document.getElementById("timeline");
	var addPost = function(post){
		var dom = document.createElement("div");
		dom.setAttribute("class",post.type);

		// HACK
		dom.onclick = gotoGame;

		// Start
		var html = ''+
			'<div id="poster">'+
			'	<div id="poster_icon" style="background:url('+post.icon+')"></div>'+
			'	<div id="poster_info">'+
			'		<span id="poster_info_name">'+post.user+'</span><br>'+
			'		<span id="poster_info_date">posted '+post.date+'</span>'+
			'	</div>'+
			'</div>'+
			'<div id="layers" style="height:'+post.data.height+'px">';

		// Layers
		for(var i=0;i<post.data.layers.length;i++){
			var layer = post.data.layers[i];
			html += '	<div style="background-image:url('+layer.img+')" depth="'+layer.depth+'" offset="'+layer.offset+'"></div>';
		}

		// End
		html += ''+
			'</div>';

		// Add to DOM
		dom.innerHTML = html;
		timeline.appendChild(dom);

	}

	posts.map(addPost);

	///////////


	var parallaxes = document.querySelectorAll(".parallax_post #layers");
	function onScroll(event){
			
		for(var i=0;i<parallaxes.length;i++){
			
			var parallax = parallaxes[i];
			var scroll = (parallax.offsetTop - window.scrollY) - 150;
			// So it's at its original position, by default, 150px from the top.
			var layers = parallax.children;

			for(var j=0;j<layers.length;j++){
				var layer = layers[j];
				var depth = parseFloat(layer.getAttribute("depth"));
				var offset = parseFloat(layer.getAttribute("offset"));
				layer.style.backgroundPositionY = -(scroll-offset)*depth;
			}

		}

	};

	var RAF = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;
	var drawnSinceLastUpdate = false;

	// Draw Loop
	function draw(){
		if(!drawnSinceLastUpdate){
			drawnSinceLastUpdate = true;
			onScroll();
		}
		RAF(draw);
	}
	draw();

	window.onscroll = function(){
		drawnSinceLastUpdate = false;
	};


};


</script>